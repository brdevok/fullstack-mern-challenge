"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _ErrorHandler=_interopRequireDefault(require("../libs/errors/ErrorHandler"));var _jsonwebtoken=_interopRequireDefault(require("jsonwebtoken"));var _JWT=require("../assets/JWT");var _ParentController=_interopRequireDefault(require("../libs/controllers/ParentController"));var _ChildrenController=_interopRequireDefault(require("../libs/controllers/ChildrenController"));var _bcrypt=_interopRequireDefault(require("bcrypt"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const entry="/auth";var _default=app=>{app.post(`${entry}/sign-up`,async(req,res)=>{try{const profile=await _ParentController.default.createParent(req.body);const tokenData={auth:true,isParent:true,id:profile._id};const token=_jsonwebtoken.default.sign(tokenData,_JWT.JWT_PRIVATE_KEY,{expiresIn:60*60});res.json({token})}catch(e){res.json(_ErrorHandler.default.response(e.message))}});app.post(`${entry}/sign-in/parent`,async(req,res)=>{try{const credentials=await _ParentController.default.getAuthCredentials(req.body.document);if(credentials){const passMatch=await _bcrypt.default.compare(req.body.password,credentials.password);if(passMatch){const tokenData={auth:true,isParent:true,id:credentials._id};const token=_jsonwebtoken.default.sign(tokenData,_JWT.JWT_PRIVATE_KEY,{expiresIn:60*60});res.json({token})}else{res.json({notMatch:true})}}else{res.json({notExist:true})}}catch(e){res.json(_ErrorHandler.default.response(e.message))}});app.post(`${entry}/sign-in/children`,async(req,res)=>{try{const credentials=await _ChildrenController.default.getAuthCredentials(req.body.document);if(credentials){const passMatch=await _bcrypt.default.compare(req.body.password,credentials.password);if(passMatch){const tokenData={auth:true,isParent:false,id:credentials._id};const token=_jsonwebtoken.default.sign(tokenData,_JWT.JWT_PRIVATE_KEY,{expiresIn:60*60});res.json({token})}else{res.json({notMatch:true})}}else{res.json({notExist:true})}}catch(e){res.json(_ErrorHandler.default.response(e.message))}})};exports.default=_default;